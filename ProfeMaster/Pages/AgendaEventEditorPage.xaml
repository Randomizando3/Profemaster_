<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ProfeMaster.Pages.AgendaEventEditorPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="{StaticResource PmBg}"
    Title="Novo item da Agenda">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="12">

            <!-- CARD: Tipo + Vínculo -->
            <Border BackgroundColor="{StaticResource PmCard}" StrokeThickness="0" StrokeShape="RoundRectangle 20">
                <VerticalStackLayout Padding="14" Spacing="10">

                    <Label Text="Tipo do item" FontAttributes="Bold" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Picker x:Name="KindPicker"
                                Title="Selecione o tipo"
                                SelectedIndexChanged="OnKindChanged" />

                        <Button Grid.Column="1"
                                x:Name="BtnClearLink"
                                Text="Limpar vínculo"
                                BackgroundColor="#243056"
                                Clicked="OnClearLinked"
                                IsVisible="False"/>
                    </Grid>

                    <!-- Vínculos (um por tipo) -->
                    <VerticalStackLayout x:Name="LinkLessonBox" Spacing="6" IsVisible="False">
                        <Label Text="Aula (opcional)" TextColor="{StaticResource PmMuted}" FontSize="12"/>
                        <Picker x:Name="LessonPicker"
                                Title="Vincular uma aula existente (opcional)"
                                SelectedIndexChanged="OnLessonLinkedChanged"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout x:Name="LinkPlanBox" Spacing="6" IsVisible="False">
                        <Label Text="Plano de aula (recomendado)" TextColor="{StaticResource PmMuted}" FontSize="12"/>
                        <Picker x:Name="PlanPicker"
                                Title="Selecione um plano de aula"
                                SelectedIndexChanged="OnPlanLinkedChanged"/>
                        <Label x:Name="PlanHintLabel"
                               TextColor="{StaticResource PmMuted}"
                               FontSize="12"
                               Text="Ao selecionar um plano, o intervalo (início/fim) será preenchido automaticamente."/>
                    </VerticalStackLayout>

                    <VerticalStackLayout x:Name="LinkEventBox" Spacing="6" IsVisible="False">
                        <Label Text="Evento (opcional)" TextColor="{StaticResource PmMuted}" FontSize="12"/>
                        <Picker x:Name="EventPicker"
                                Title="Vincular um evento existente (opcional)"
                                SelectedIndexChanged="OnEventLinkedChanged"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout x:Name="LinkExamBox" Spacing="6" IsVisible="False">
                        <Label Text="Prova (opcional)" TextColor="{StaticResource PmMuted}" FontSize="12"/>
                        <Picker x:Name="ExamPicker"
                                Title="Vincular uma prova existente (opcional)"
                                SelectedIndexChanged="OnExamLinkedChanged"/>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </Border>

            <!-- CARD: Dados -->
            <Border BackgroundColor="{StaticResource PmCard}" StrokeThickness="0" StrokeShape="RoundRectangle 20">
                <VerticalStackLayout Padding="14" Spacing="10">

                    <Label Text="Dados" FontAttributes="Bold" />

                    <Entry x:Name="TitleEntry" Placeholder="Nome do item (ex: Aula de Matemática / Prova / Evento)" />

                    <Editor x:Name="DescEditor"
                            AutoSize="TextChanges"
                            Placeholder="Descrição (opcional)..." />

                </VerticalStackLayout>
            </Border>

            <!-- CARD: Data e Hora -->
            <Border BackgroundColor="{StaticResource PmCard}" StrokeThickness="0" StrokeShape="RoundRectangle 20">
                <VerticalStackLayout Padding="14" Spacing="10">

                    <Label Text="Data e horário" FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Início" TextColor="{StaticResource PmMuted}" FontSize="12"/>
                            <DatePicker x:Name="StartDatePicker" DateSelected="OnAnyDateChanged"/>
                            <TimePicker x:Name="StartTimePicker" PropertyChanged="OnAnyTimeChanged"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="6">
                            <Label Text="Fim" TextColor="{StaticResource PmMuted}" FontSize="12"/>
                            <DatePicker x:Name="EndDatePicker" DateSelected="OnAnyDateChanged"/>
                            <TimePicker x:Name="EndTimePicker" PropertyChanged="OnAnyTimeChanged"/>
                        </VerticalStackLayout>
                    </Grid>

                    <Label x:Name="RangeHintLabel"
                           TextColor="{StaticResource PmMuted}"
                           FontSize="12"
                           Text="Dica: Plano de aula e Evento podem ocupar vários dias. Aula/Prova normalmente é um único dia." />

                </VerticalStackLayout>
            </Border>

            <!-- AÇÕES -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Text="Cancelar" BackgroundColor="#3A2040" Clicked="OnCancel"/>
                <Button Grid.Column="1" Text="Salvar" Background="{StaticResource PmGradient}" Clicked="OnSave"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
