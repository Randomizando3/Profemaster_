<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ProfeMaster.Pages.InstitutionsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="#FFFFFF"
    Title=""
    Shell.NavBarIsVisible="False">

    <Grid Padding="18" RowSpacing="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TOP BAR (sem título) -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">

            <Label Text="Instituições"
                   FontAttributes="Bold"
                   FontSize="14"
                   TextColor="#111827"
                   VerticalOptions="Center"
                   IsVisible="False"/>

            <Button Grid.Column="1"
                    Text="Atualizar"
                    HeightRequest="40"
                    Padding="14,0"
                    CornerRadius="16"
                    BackgroundColor="#F2F2F2"
                    TextColor="#111827"
                    FontAttributes="Bold"
                    FontSize="12"
                    Clicked="OnRefreshClicked" />

            <!-- + Nova com gradiente inline -->
            <Border Grid.Column="2"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 16"
                    HeightRequest="40"
                    VerticalOptions="Center">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#6A4FF0" Offset="0" />
                        <GradientStop Color="#9B7BFF" Offset="1" />
                    </LinearGradientBrush>
                </Border.Background>

                <Button Text="+ Nova"
                        HeightRequest="40"
                        Padding="14,0"
                        CornerRadius="16"
                        BackgroundColor="Transparent"
                        TextColor="#FFFFFF"
                        FontAttributes="Bold"
                        FontSize="12"
                        Clicked="OnAddClicked" />
            </Border>
        </Grid>

        <!-- LISTA -->
        <CollectionView Grid.Row="1"
                        x:Name="List"
                        ItemsSource="{Binding Institutions}"
                        SelectionMode="None"
                        Margin="0,2,0,0">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Margin="0,0,0,12"
                            BackgroundColor="#FFFFFF"
                            Stroke="#E5E7EB"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 18">

                        <!-- Card compacto: texto 2/3 e ações 1/3 -->
                        <Grid Padding="12"
                              ColumnSpacing="12"
                              ColumnDefinitions="2.2*,1*">

                            <!-- TEXTO -->
                            <VerticalStackLayout Grid.Column="0"
                                                 Spacing="2"
                                                 VerticalOptions="Center">

                                <Label Text="{Binding Name}"
                                       FontAttributes="Bold"
                                       FontSize="14"
                                       TextColor="#7A2FA6"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="1"/>

                                <Label Text="{Binding Type}"
                                       FontSize="12"
                                       TextColor="#6B7280"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="1"/>

                                <!-- Observação (some se vazio) -->
                                <Label FontSize="12"
                                       TextColor="#9CA3AF"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="1">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Notes}"
                                                     Value="">
                                            <Setter Property="IsVisible" Value="False"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding Notes}"
                                                     Value="{x:Null}">
                                            <Setter Property="IsVisible" Value="False"/>
                                        </DataTrigger>
                                    </Label.Triggers>
                                    <Label.Text>
                                        <Binding Path="Notes"/>
                                    </Label.Text>
                                </Label>

                            </VerticalStackLayout>

                            <!-- AÇÕES: Turmas em cima, lápis+X embaixo -->
                            <Grid Grid.Column="1"
                                  RowDefinitions="Auto,Auto"
                                  RowSpacing="8"
                                  VerticalOptions="Center">

                                <!-- Turmas -->
                                <Border Grid.Row="0"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 14"
                                        HeightRequest="36">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#6A4FF0" Offset="0" />
                                            <GradientStop Color="#9B7BFF" Offset="1" />
                                        </LinearGradientBrush>
                                    </Border.Background>

                                    <Button Text="Turmas"
                                            HeightRequest="36"
                                            Padding="10,0"
                                            CornerRadius="14"
                                            BackgroundColor="Transparent"
                                            TextColor="#FFFFFF"
                                            FontAttributes="Bold"
                                            FontSize="12"
                                            Clicked="OnClassesClicked"/>
                                </Border>

                                <!-- lápis + X -->
                                <Grid Grid.Row="1"
                                      ColumnDefinitions="Auto,Auto"
                                      ColumnSpacing="8"
                                      HorizontalOptions="End">

                                    <Button Grid.Column="0"
                                            Text="✏️"
                                            HeightRequest="36"
                                            WidthRequest="44"
                                            Padding="0"
                                            CornerRadius="12"
                                            BackgroundColor="#F2F2F2"
                                            TextColor="#111827"
                                            FontSize="14"
                                            Clicked="OnEditClicked"/>

                                    <Button Grid.Column="1"
                                            Text="X"
                                            HeightRequest="36"
                                            WidthRequest="44"
                                            Padding="0"
                                            CornerRadius="12"
                                            BackgroundColor="#FF0000"
                                            TextColor="#FFFFFF"
                                            FontAttributes="Bold"
                                            FontSize="12"
                                            Clicked="OnDeleteClicked"/>
                                </Grid>

                            </Grid>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- OVERLAY EDITOR (ADD/EDIT) -->
        <Grid x:Name="EditorOverlay"
              IsVisible="False"
              BackgroundColor="#80000000"
              Grid.RowSpan="2"
              Padding="18,0">

            <!-- Mantém central, mas com “respiro” lateral -->
            <Grid VerticalOptions="Center"
                  HorizontalOptions="Center"
                  WidthRequest="380"
                  MaximumWidthRequest="420">

                <Border BackgroundColor="#FFFFFF"
                        Stroke="#E5E7EB"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 22">

                    <VerticalStackLayout Padding="16" Spacing="14">

                        <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                            <Label x:Name="EditorTitleLabel"
                                   Text="Nova instituição"
                                   FontAttributes="Bold"
                                   FontSize="14"
                                   TextColor="#111827"
                                   VerticalOptions="Center" />

                            <Button Grid.Column="1"
                                    Text="X"
                                    HeightRequest="34"
                                    WidthRequest="44"
                                    Padding="0"
                                    CornerRadius="12"
                                    BackgroundColor="#F2F2F2"
                                    TextColor="#111827"
                                    Clicked="OnEditorClose"/>
                        </Grid>

                        <!-- Nome -->
                        <Border Stroke="#E5E7EB"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 16"
                                BackgroundColor="#FFFFFF"
                                Padding="14,0"
                                HeightRequest="54">
                            <Grid VerticalOptions="Center">
                                <Entry x:Name="NameEntry"
                                       Placeholder="Nome da instituição"
                                       TextColor="#111827"
                                       PlaceholderColor="#9CA3AF"
                                       BackgroundColor="Transparent"
                                       VerticalTextAlignment="Center"
                                       HeightRequest="54"/>
                            </Grid>
                        </Border>

                        <!-- Tipo (Picker) - corrige “1px” e mantém visual consistente -->
                        <Border Stroke="#E5E7EB"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 16"
                                BackgroundColor="#FFFFFF"
                                Padding="14,0"
                                HeightRequest="54">
                            <Grid ColumnDefinitions="*,Auto"
                                  VerticalOptions="Center">

                                <!-- Picker ocupa a área toda -->
                                <Picker x:Name="TypePicker"
                                        Title="Tipo"
                                        BackgroundColor="Transparent"
                                        TextColor="#111827"
                                        TitleColor="#9CA3AF"
                                        HeightRequest="54"
                                        VerticalOptions="Center" />

                                <!-- Seta desenhada, para não depender do estilo do Windows -->
                                <Label Grid.Column="1"
                                       Text="▾"
                                       FontSize="16"
                                       TextColor="#6B7280"
                                       VerticalOptions="Center"
                                       HorizontalOptions="End"
                                       Margin="10,0,2,0"/>
                            </Grid>
                        </Border>

                        <!-- Observação -->
                        <Border Stroke="#E5E7EB"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 16"
                                BackgroundColor="#FFFFFF"
                                Padding="14,12">
                            <Editor x:Name="NotesEditor"
                                    Placeholder="Observação (opcional)"
                                    AutoSize="TextChanges"
                                    BackgroundColor="Transparent"
                                    TextColor="#111827"
                                    PlaceholderColor="#9CA3AF"
                                    HeightRequest="110"/>
                        </Border>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,4,0,0">
                            <Button Text="Cancelar"
                                    HeightRequest="46"
                                    CornerRadius="16"
                                    BackgroundColor="#F2F2F2"
                                    TextColor="#111827"
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Clicked="OnEditorCancel"/>

                            <Border Grid.Column="1"
                                    StrokeThickness="0"
                                    StrokeShape="RoundRectangle 16"
                                    HeightRequest="46">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#6A4FF0" Offset="0" />
                                        <GradientStop Color="#9B7BFF" Offset="1" />
                                    </LinearGradientBrush>
                                </Border.Background>

                                <Button Text="Salvar"
                                        HeightRequest="46"
                                        CornerRadius="16"
                                        BackgroundColor="Transparent"
                                        TextColor="#FFFFFF"
                                        FontAttributes="Bold"
                                        FontSize="12"
                                        Clicked="OnEditorSave"/>
                            </Border>
                        </Grid>

                    </VerticalStackLayout>
                </Border>
            </Grid>
        </Grid>

    </Grid>
</ContentPage>
