<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ProfeMaster.Pages.EventEditorPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="#FFFFFF"
    Title=""
    Shell.NavBarIsVisible="False">

    <ContentPage.Resources>

        <!-- Paleta padrÃ£o -->
        <Color x:Key="PmText">#2B2B2B</Color>
        <Color x:Key="PmMuted">#7B7B7B</Color>
        <Color x:Key="PmStroke">#E6E6E6</Color>

        <LinearGradientBrush x:Key="PmGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#B66AF4" Offset="0" />
            <GradientStop Color="#7E97D9" Offset="1" />
        </LinearGradientBrush>

        <Style x:Key="PmCardBorder" TargetType="Border">
            <Setter Property="BackgroundColor" Value="#FFFFFF" />
            <Setter Property="Stroke" Value="{StaticResource PmStroke}" />
            <Setter Property="StrokeThickness" Value="2" />
            <Setter Property="StrokeShape" Value="RoundRectangle 18" />
        </Style>

        <Style x:Key="PmH1" TargetType="Label">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="TextColor" Value="{StaticResource PmText}" />
        </Style>

        <Style x:Key="PmH2" TargetType="Label">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="TextColor" Value="{StaticResource PmText}" />
        </Style>

        <Style x:Key="PmCaption" TargetType="Label">
            <Setter Property="FontSize" Value="10" />
            <Setter Property="TextColor" Value="{StaticResource PmMuted}" />
        </Style>

        <Style x:Key="PmEntryBase" TargetType="Entry">
            <Setter Property="TextColor" Value="{StaticResource PmText}" />
            <Setter Property="PlaceholderColor" Value="{StaticResource PmMuted}" />
            <Setter Property="BackgroundColor" Value="Transparent" />
        </Style>

        <Style x:Key="PmEditorBase" TargetType="Editor">
            <Setter Property="TextColor" Value="{StaticResource PmText}" />
            <Setter Property="PlaceholderColor" Value="{StaticResource PmMuted}" />
            <Setter Property="BackgroundColor" Value="Transparent" />
        </Style>

        <Style x:Key="PmBtnPrimary" TargetType="Button">
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextColor" Value="#FFFFFF" />
            <Setter Property="Background" Value="{StaticResource PmGradient}" />
            <Setter Property="Padding" Value="14,12" />
        </Style>

        <Style x:Key="PmBtnSoft" TargetType="Button">
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="TextColor" Value="{StaticResource PmText}" />
            <Setter Property="BackgroundColor" Value="#F2F2F2" />
            <Setter Property="Padding" Value="12,10" />
        </Style>

        <Style x:Key="PmBtnDanger" TargetType="Button">
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="TextColor" Value="#FFFFFF" />
            <Setter Property="BackgroundColor" Value="#3A2040" />
            <Setter Property="Padding" Value="12,10" />
        </Style>

        <Style x:Key="PmDayCard" TargetType="Border">
            <Setter Property="BackgroundColor" Value="#FFFFFF" />
            <Setter Property="Stroke" Value="{StaticResource PmStroke}" />
            <Setter Property="StrokeThickness" Value="2" />
            <Setter Property="StrokeShape" Value="RoundRectangle 16" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <Style x:Key="PmInnerCard" TargetType="Border">
            <Setter Property="BackgroundColor" Value="#FFFFFF" />
            <Setter Property="Stroke" Value="{StaticResource PmStroke}" />
            <Setter Property="StrokeThickness" Value="2" />
            <Setter Property="StrokeShape" Value="RoundRectangle 14" />
        </Style>

        <!-- Campo visÃ­vel p/ DatePicker/TimePicker (overlay clicÃ¡vel) -->
        <Style x:Key="PmPickerField" TargetType="Border">
            <Setter Property="BackgroundColor" Value="#FFFFFF" />
            <Setter Property="Stroke" Value="{StaticResource PmStroke}" />
            <Setter Property="StrokeThickness" Value="2" />
            <Setter Property="StrokeShape" Value="RoundRectangle 16" />
            <Setter Property="Padding" Value="12,10" />
        </Style>

    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="18" Spacing="12">

            <!-- TOP BAR -->
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <Label Text="Evento" Style="{StaticResource PmH1}" VerticalOptions="Center"/>

                <Button Grid.Column="1"
                        Text="X"
                        Style="{StaticResource PmBtnSoft}"
                        Clicked="OnClose"
                        VerticalOptions="Center"
                        WidthRequest="44"
                        HeightRequest="44"
                        Padding="0"/>
            </Grid>

            <!-- DADOS -->
            <Border Style="{StaticResource PmCardBorder}">
                <VerticalStackLayout Padding="14" Spacing="10">

                    <Label Text="Dados do evento" Style="{StaticResource PmH2}"/>

                    <!-- âœ… CAPA DO EVENTO -->
                    <VerticalStackLayout Spacing="8">

                        <Label Text="Capa do evento" Style="{StaticResource PmCaption}" />

                        <Border Style="{StaticResource PmInnerCard}"
                                Padding="0"
                                StrokeShape="RoundRectangle 16"
                                HeightRequest="170">

                            <Grid>
                                <Image x:Name="ThumbPreview"
                                       Aspect="AspectFill" />

                                <!-- placeholder sutil quando nÃ£o tem imagem -->
                                <Grid x:Name="ThumbPlaceholder"
                                      BackgroundColor="#F5F5F5"
                                      Opacity="1">
                                    <VerticalStackLayout HorizontalOptions="Center"
                                                         VerticalOptions="Center"
                                                         Spacing="6">
                                        <Label Text="Sem capa"
                                               FontAttributes="Bold"
                                               FontSize="12"
                                               TextColor="{StaticResource PmMuted}"
                                               HorizontalTextAlignment="Center"/>
                                        <Label Text="Toque em 'Escolher capa'"
                                               FontSize="10"
                                               TextColor="{StaticResource PmMuted}"
                                               HorizontalTextAlignment="Center"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Grid>
                        </Border>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <Button Text="Escolher capa"
                                    Style="{StaticResource PmBtnSoft}"
                                    Clicked="OnPickThumb" />
                            <Button Grid.Column="1"
                                    Text="Remover capa"
                                    Style="{StaticResource PmBtnDanger}"
                                    Clicked="OnRemoveThumb" />
                        </Grid>

                    </VerticalStackLayout>

                    <Border Style="{StaticResource PmInnerCard}" Padding="12,10">
                        <Entry x:Name="TitleEntry"
                               Style="{StaticResource PmEntryBase}"
                               Placeholder="Nome do evento" />
                    </Border>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <!-- InÃ­cio -->
                        <Border Style="{StaticResource PmPickerField}">
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                <Label Text="InÃ­cio" Style="{StaticResource PmCaption}" Margin="0,0,0,2"/>
                                <Label Grid.Row="1"
                                       Text="{Binding Source={x:Reference StartDatePick}, Path=Date, StringFormat='{0:dd/MM/yyyy}'}"
                                       FontSize="12"
                                       TextColor="{StaticResource PmText}" />
                                <Label Grid.Column="1"
                                       Grid.RowSpan="2"
                                       Text="ðŸ“…"
                                       FontSize="14"
                                       TextColor="{StaticResource PmMuted}"
                                       VerticalOptions="Center"
                                       Margin="8,0,0,0"/>
                                <DatePicker x:Name="StartDatePick"
                                            Grid.RowSpan="2"
                                            Grid.ColumnSpan="2"
                                            DateSelected="OnDatesChanged"
                                            Opacity="0.02"
                                            BackgroundColor="#FFFFFF"
                                            TextColor="{StaticResource PmText}" />
                            </Grid>
                        </Border>

                        <!-- Fim -->
                        <Border Grid.Column="1" Style="{StaticResource PmPickerField}">
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                <Label Text="Fim" Style="{StaticResource PmCaption}" Margin="0,0,0,2"/>
                                <Label Grid.Row="1"
                                       Text="{Binding Source={x:Reference EndDatePick}, Path=Date, StringFormat='{0:dd/MM/yyyy}'}"
                                       FontSize="12"
                                       TextColor="{StaticResource PmText}" />
                                <Label Grid.Column="1"
                                       Grid.RowSpan="2"
                                       Text="ðŸ“…"
                                       FontSize="14"
                                       TextColor="{StaticResource PmMuted}"
                                       VerticalOptions="Center"
                                       Margin="8,0,0,0"/>
                                <DatePicker x:Name="EndDatePick"
                                            Grid.RowSpan="2"
                                            Grid.ColumnSpan="2"
                                            DateSelected="OnDatesChanged"
                                            Opacity="0.02"
                                            BackgroundColor="#FFFFFF"
                                            TextColor="{StaticResource PmText}" />
                            </Grid>
                        </Border>
                    </Grid>

                    <Label x:Name="SlotsInfoLabel"
                           Text="Dias: 0"
                           Style="{StaticResource PmCaption}"
                           Margin="2,0,0,0"/>

                    <Label Text="DescriÃ§Ã£o / observaÃ§Ãµes" Style="{StaticResource PmCaption}"/>

                    <Border Style="{StaticResource PmInnerCard}" Padding="12,10">
                        <Editor x:Name="DescEditor"
                                Style="{StaticResource PmEditorBase}"
                                AutoSize="TextChanges"
                                Placeholder="Detalhes gerais do evento..." />
                    </Border>

                </VerticalStackLayout>
            </Border>

            <!-- ATRAÃ‡Ã•ES -->
            <Border Style="{StaticResource PmCardBorder}">
                <VerticalStackLayout Padding="14" Spacing="10">

                    <VerticalStackLayout Spacing="2">
                        <Label Text="AtraÃ§Ãµes por dia" Style="{StaticResource PmH2}"/>
                        <Label Text="Adicione mÃºltiplas atraÃ§Ãµes por dia e defina horÃ¡rios."
                               Style="{StaticResource PmCaption}"/>
                    </VerticalStackLayout>

                    <Label x:Name="EmptySlotsLabel"
                           IsVisible="False"
                           Text="Defina o perÃ­odo para gerar os dias do evento."
                           TextColor="{StaticResource PmMuted}"
                           HorizontalTextAlignment="Center"
                           Margin="0,8,0,0"
                           FontSize="11"/>

                    <CollectionView x:Name="SlotsList" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>

                                <Border Style="{StaticResource PmDayCard}">
                                    <VerticalStackLayout Padding="12" Spacing="10">

                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                            <Label Text="{Binding DateLabel}"
                                                   FontAttributes="Bold"
                                                   FontSize="13"
                                                   TextColor="{StaticResource PmText}"
                                                   VerticalOptions="Center"/>

                                            <Button Grid.Column="1"
                                                    Text="+ AtraÃ§Ã£o"
                                                    Style="{StaticResource PmBtnSoft}"
                                                    Clicked="OnAddAttraction"
                                                    CommandParameter="{Binding .}"
                                                    VerticalOptions="Center"/>
                                        </Grid>

                                        <VerticalStackLayout BindableLayout.ItemsSource="{Binding Items}" Spacing="10">
                                            <BindableLayout.ItemTemplate>
                                                <DataTemplate>

                                                    <Border Style="{StaticResource PmInnerCard}">
                                                        <VerticalStackLayout Padding="12" Spacing="10">

                                                            <Border Style="{StaticResource PmInnerCard}" Padding="12,10">
                                                                <Entry Placeholder="Nome da atraÃ§Ã£o"
                                                                       Style="{StaticResource PmEntryBase}"
                                                                       Text="{Binding Title, Mode=TwoWay}"
                                                                       TextChanged="OnAttractionTextChanged"/>
                                                            </Border>

                                                            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">

                                                                <Border Style="{StaticResource PmPickerField}">
                                                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                                                        <Label Text="InÃ­cio" Style="{StaticResource PmCaption}" Margin="0,0,0,2"/>
                                                                        <Label Grid.Row="1"
                                                                               Text="{Binding StartTime, StringFormat='{0:hh\\:mm}'}"
                                                                               FontSize="12"
                                                                               TextColor="{StaticResource PmText}"/>
                                                                        <Label Grid.Column="1"
                                                                               Grid.RowSpan="2"
                                                                               Text="ðŸ•’"
                                                                               FontSize="14"
                                                                               TextColor="{StaticResource PmMuted}"
                                                                               VerticalOptions="Center"
                                                                               Margin="8,0,0,0"/>
                                                                        <TimePicker Time="{Binding StartTime, Mode=TwoWay}"
                                                                                    Grid.RowSpan="2"
                                                                                    Grid.ColumnSpan="2"
                                                                                    Opacity="0.02"
                                                                                    PropertyChanged="OnAttractionTimeChanged"
                                                                                    TextColor="{StaticResource PmText}"
                                                                                    BackgroundColor="#FFFFFF"/>
                                                                    </Grid>
                                                                </Border>

                                                                <Border Grid.Column="1" Style="{StaticResource PmPickerField}">
                                                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                                                        <Label Text="Fim" Style="{StaticResource PmCaption}" Margin="0,0,0,2"/>
                                                                        <Label Grid.Row="1"
                                                                               Text="{Binding EndTime, StringFormat='{0:hh\\:mm}'}"
                                                                               FontSize="12"
                                                                               TextColor="{StaticResource PmText}"/>
                                                                        <Label Grid.Column="1"
                                                                               Grid.RowSpan="2"
                                                                               Text="ðŸ•’"
                                                                               FontSize="14"
                                                                               TextColor="{StaticResource PmMuted}"
                                                                               VerticalOptions="Center"
                                                                               Margin="8,0,0,0"/>
                                                                        <TimePicker Time="{Binding EndTime, Mode=TwoWay}"
                                                                                    Grid.RowSpan="2"
                                                                                    Grid.ColumnSpan="2"
                                                                                    Opacity="0.02"
                                                                                    PropertyChanged="OnAttractionTimeChanged"
                                                                                    TextColor="{StaticResource PmText}"
                                                                                    BackgroundColor="#FFFFFF"/>
                                                                    </Grid>
                                                                </Border>

                                                            </Grid>

                                                            <Label Text="Notas (opcional)" Style="{StaticResource PmCaption}"/>

                                                            <Border Style="{StaticResource PmInnerCard}" Padding="12,10">
                                                                <Editor Placeholder="Notas..."
                                                                        Style="{StaticResource PmEditorBase}"
                                                                        AutoSize="TextChanges"
                                                                        Text="{Binding Notes, Mode=TwoWay}"
                                                                        TextChanged="OnAttractionTextChanged"/>
                                                            </Border>

                                                            <Button Text="Remover"
                                                                    Style="{StaticResource PmBtnDanger}"
                                                                    Clicked="OnRemoveAttraction"
                                                                    CommandParameter="{Binding .}"/>

                                                        </VerticalStackLayout>
                                                    </Border>

                                                </DataTemplate>
                                            </BindableLayout.ItemTemplate>
                                        </VerticalStackLayout>

                                    </VerticalStackLayout>
                                </Border>

                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                </VerticalStackLayout>
            </Border>

            <!-- FOOTER -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Text="Cancelar"
                        Style="{StaticResource PmBtnDanger}"
                        Clicked="OnCancel"/>

                <Button Grid.Column="1"
                        Text="Salvar"
                        Style="{StaticResource PmBtnPrimary}"
                        Clicked="OnClosePrimary"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
